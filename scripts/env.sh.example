#!/bin/bash

# =============================================================================
# ðŸ”¥ SDCoLab Scheduler - Environment Configuration
# =============================================================================
#
# SETUP:
#   1. Copy this file:  cp env.sh.example env.sh
#   2. Fill in your values below
#   3. Source before deploy:  source ./scripts/env.sh && ./scripts/deploy.sh
#
# SECURITY:
#   - env.sh is in .gitignore - never commit it!
#   - Keep a backup somewhere safe (password manager, etc)
#
# =============================================================================

# =============================================================================
# TERRAFORM STATE (Recommended - preserves state across rebuilds)
# =============================================================================

export TF_STATE_DIR="$HOME/.sdcolab-terraform"

# =============================================================================
# AWS CREDENTIALS
# =============================================================================
# Option 1: Set explicitly (not recommended - use AWS CLI profiles instead)
# export AWS_ACCESS_KEY_ID="AKIA..."
# export AWS_SECRET_ACCESS_KEY="..."
# export AWS_REGION="us-west-2"

# Option 2: Use a named profile (recommended)
# export AWS_PROFILE="sdcolab"

# =============================================================================
# DEPLOYMENT SETTINGS
# =============================================================================

export ENV="prod"                        # Environment name (dev, staging, prod)
export HOSTING_TYPE="amplify"            # "amplify" (HTTPS) or "s3" (HTTP)
export ORPHAN_MODE="import"              # "import", "prompt", "delete", "skip"
# export AUTO_APPROVE="true"             # Uncomment for CI/CD (skips all prompts)

# =============================================================================
# DNS CONFIGURATION
# =============================================================================

export DNS_ZONE_NAME="mid.dog"           # Your Route53 zone
export DNS_SUBDOMAIN="sdcolab"           # Creates: sdcolab.mid.dog
export MANAGE_DNS="true"                 # Set "false" if managing DNS elsewhere

# =============================================================================
# GOOGLE OAUTH (Required for Google login)
# =============================================================================
# Get these from: https://console.cloud.google.com/apis/credentials

export ENABLE_AUTH_GOOGLE="true"
export GOOGLE_CLIENT_ID="xxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.apps.googleusercontent.com"
export GOOGLE_CLIENT_SECRET="GOCSPX-xxxxxxxxxxxxxxxxxxxxxxxx"

# =============================================================================
# MICROSOFT OAUTH (Optional)
# =============================================================================
# Get these from: https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps

export ENABLE_AUTH_MICROSOFT="false"
# export MICROSOFT_CLIENT_ID="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
# export MICROSOFT_CLIENT_SECRET="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
# export MICROSOFT_TENANT_ID="common"    # or your tenant ID for single-tenant

# =============================================================================
# GITHUB OAUTH (Optional - for GitHub login)
# =============================================================================
# Get these from: https://github.com/settings/developers

export ENABLE_AUTH_GITHUB="false"
# export GITHUB_OAUTH_CLIENT_ID="Ov23li..."
# export GITHUB_OAUTH_CLIENT_SECRET="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

# =============================================================================
# GITHUB INTEGRATION (Optional - for issue tracking)
# =============================================================================
# Different from GitHub OAuth! This is for creating issues in a repo.
# Get token from: https://github.com/settings/tokens (needs 'repo' scope)

export ENABLE_GITHUB="false"
# export GITHUB_TOKEN="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
# export GITHUB_ORG="your-org"           # or your username
# export GITHUB_REPO="your-repo"         # repository for issues

# =============================================================================
# SLACK INTEGRATION (Optional)
# =============================================================================
# Get webhook from: https://api.slack.com/apps â†’ Incoming Webhooks

export ENABLE_SLACK="false"
# export SLACK_WEBHOOK_URL="https://hooks.slack.com/services/T.../B.../xxx..."

# =============================================================================
# GOOGLE CALENDAR (Optional)
# =============================================================================
# Requires additional setup - see API_KEY_SETUP_GUIDE.md

export ENABLE_GCAL="false"
# export GCAL_AUTH_METHOD="service_account"  # or "workload_identity"
# export GCAL_PRIMARY_CALENDAR_ID="your-calendar@group.calendar.google.com"

# For service account method:
# export GCAL_CLIENT_EMAIL="scheduler@your-project.iam.gserviceaccount.com"
# export GCAL_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"

# For workload identity method:
# export GCAL_PROJECT_NUMBER="123456789"
# export GCAL_POOL_ID="sdcolab-aws-pool"
# export GCAL_PROVIDER_ID="aws-lambda"
# export GCAL_SERVICE_ACCOUNT_EMAIL="scheduler@your-project.iam.gserviceaccount.com"

# =============================================================================
# EMAIL (Optional - uses AWS SES)
# =============================================================================
# Requires verified domain/email in AWS SES

export ENABLE_EMAIL="false"
# export SES_FROM_EMAIL="noreply@yourdomain.com"
# export SES_REPLY_TO_EMAIL="support@yourdomain.com"

# =============================================================================
# OTHER SETTINGS
# =============================================================================

# API key for scheduled jobs (auto-generated if not set)
# export SCHEDULER_API_KEY="your-secure-random-key"

# Enable audit logging
export ENABLE_AUDIT_LOG="true"

# Show demo login hint on frontend (for dev/staging environments)
# export VITE_SHOW_DEMO_HINT="true"

# =============================================================================
# DONE! Now run:
#   source ./scripts/env.sh && ./scripts/deploy.sh
# =============================================================================

echo "âœ… Environment loaded for: $ENV"
echo "   Domain: ${DNS_SUBDOMAIN}.${DNS_ZONE_NAME}"
echo "   Google Auth: $ENABLE_AUTH_GOOGLE"
echo "   Microsoft Auth: $ENABLE_AUTH_MICROSOFT"
echo "   GitHub Auth: $ENABLE_AUTH_GITHUB"
echo "   GitHub Issues: $ENABLE_GITHUB"
echo "   Slack: $ENABLE_SLACK"
echo "   Google Calendar: $ENABLE_GCAL"
echo "   Email: $ENABLE_EMAIL"
echo ""
